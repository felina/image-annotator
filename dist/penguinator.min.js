/*! penguinator - v3.8.1 - 2017-05-09
* https://github.com/felina/image-annotator
* Copyright (c) 2017 Alistair Wick <alistair.wk@gmail.com>; Licensed MIT */

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){this.parent=a,this.anns=[],this.aInd=0,this.fInd=0,this.ftrs=[],this.curType="rect"}var e=a("./feature"),f=a("./util").createAnnotation;d.fn=d.prototype,d.fn.getAnn=function(){return 0===this.anns.length?null:this.anns[this.aInd]},d.fn.replaceAnn=function(a){this.anns[this.aInd]=a},d.fn.setAnn=function(a){for(var b=0;b<this.ftrs.length;b++)for(var c=this.ftrs[b],d=0;d<c.anns.length;d++){var e=c.anns[d];if(e===a)return this.fInd=b,this.ftrChanged(),this.aInd=d,void(this.anns=this.getFtr().anns)}},d.fn.getFtr=function(){return 0===this.ftrs.length?null:this.ftrs[this.fInd]},d.fn.getFtrs=function(){return this.ftrs},d.fn.setFtr=function(a){for(var b=0;b<this.ftrs.length;b++)if(a===this.ftrs[b])return this.fInd=b,void this.ftrChanged()},d.fn.reset=function(){this.anns=[],this.aInd=0,this.fInd=0,this.ftrs=[],this.curType="rect"},d.fn.addFtrData=function(a){this.ftrs.push(new e(a.name,a.required,a.shape))},d.fn.importFeatures=function(a){this.ftrs=[],null!==a&&0!==a.length||(a=[new e("Image",!1,"any")]);for(var b=0;b<a.length;b++)this.addFtrData(a[b]);this.parent.updateFtrs(this.ftrs),this.ftrChanged()},d.fn.importAnns=function(a){for(var b=0;b<this.ftrs.length;b++){var c=this.ftrs[b];if(c.anns=[],void 0!==a[c.name])for(var d=a[c.name],e=d.shapes,g=0;g<e.length;g++){var h=e[g],i=f(h.type);i.valid=!0,"rect"===h.type?(i.pts[0]=h.pos,i.pts[1]={x:h.pos.x+h.size.width,y:h.pos.y+h.size.height}):"point"==h.type?i.pts[0]=h.pos:i.pts=h.points,c.anns.push(i)}}this.anns=this.getFtr().anns,this.parent.showChange()},d.fn.exportAnns=function(){for(var a={},b=0;b<this.ftrs.length;b++){var c=this.ftrs[b];a[c.name]={},a[c.name].shapes=[];for(var d=0;d<c.anns.length;d++){var e=c.anns[d];if(void 0!==e&&e.valid){var f=e.getExport();a[c.name].shapes.push(f)}}}return a},d.fn.ftrChanged=function(){var a="any"!==this.getFtr().shape;this.parent.lockSelect(this.getFtr().shape,a),a&&(this.curType=this.getFtr().shape),this.anns=this.getFtr().anns,this.aInd=0,0===this.anns.length&&this.anns.push(f(this.curType)),this.parent.dispFtr(this.getFtr()),this.parent.showChange()},d.fn.nextFtr=function(){this.fInd++,this.fInd>=this.ftrs.length&&(this.fInd=this.ftrs.length-1),this.ftrChanged()},d.fn.prevFtr=function(){this.fInd--,this.fInd<0&&(this.fInd=0),this.ftrChanged()},d.fn.delAnn=function(){this.getAnn().invalidate(),this.clrInvalid()},d.fn.newAnn=function(){return this.anns.push(f(this.curType)),this.aInd=this.anns.length-1,this.getAnn()},d.fn.pickPt=function(a,b){var c={};c.pt=null,c.dist=1/0,c.ann=null,c.ind=0;for(var d=0;d<this.ftrs.length;d++)for(var e=this.ftrs[d].anns,f=0;f<e.length;f++){var g=e[f];if(g.isValid())for(var h=g.getPts(),i=0;i<h.length;i++){var j=h[i],k=Math.sqrt(Math.pow(a-j.x,2)+Math.pow(b-j.y,2));k<c.dist&&(c.dist=k,c.pt=j,c.ind=i,c.ann=g)}}return c},d.fn.pickLn=function(a,b){var c={};c.pt=null,c.dist=1/0,c.ann=null,c.i0=0,c.i1=0,c.endpt=!1;for(var d=0;d<this.ftrs.length;d++)for(var e=this.ftrs[d].anns,f=0;f<e.length;f++){var g=e[f];if(g.isValid())for(var h=g.getDrawPts(),i=0;i<h.length-1;i++){var j=i,k=i+1,l=h[j],m=h[k],n=((a-l.x)*(m.x-l.x)+(b-l.y)*(m.y-l.y))/(Math.pow(m.x-l.x,2)+Math.pow(m.y-l.y,2)),o=!1;n<=0?(n=0,o=!0):n>=1&&(n=1,o=!0);var p={};p.x=l.x+n*(m.x-l.x),p.y=l.y+n*(m.y-l.y);var q=Math.sqrt(Math.pow(a-p.x,2)+Math.pow(b-p.y,2));q<c.dist&&(c.dist=q,c.pt=p,c.ann=g,c.i0=j,c.i1=k,c.endpt=o)}}return c},d.fn.changeType=function(a){this.curType=a},d.fn.clrInvalid=function(){for(var a=0;a<this.anns.length;a++)if(a!==this.aInd){var b=this.anns[a];b.valid||(this.anns.splice(a,1),this.aInd>a&&this.aInd--)}},b.exports=d},{"./feature":5,"./util":16}],2:[function(a,b,c){function d(a,b,c){this.img=a,this.originalW=b,this.originalH=c,this.w=b,this.h=c,this.divRight=null,this.divLeft=null,this.zoomin=null,this.zoomout=null,this.pan=null,this.annotate=null,this.edit=null,this.annType=null,this.ftrSel=null,this.delAnn=null,this.tip=null,this.gofull=null,this.title=null,this.parent=null,this.container=null,this.canvas=null,this.curTool=new g(this),this.annHelper=new e(this),this.cHelper=null}var e=a("./annHelper"),f=a("./canvasHelper"),g=a("./tools/pan"),h=a("./tools/annotate"),i=a("./tools/edit"),j={position:"relative",overflow:"hidden"},k={position:"absolute",left:0,top:0,"z-index":100,cursor:"move"};d.fn=d.prototype,d.fn.featuresIn=function(a){if(void 0===a.features)return void console.log("Not a valid object:",a);this.annHelper.importFeatures(a.features),this.showChange()},d.fn.annsIn=function(a){if(void 0===a.annotations)return void console.log("Not a valid object:",a);this.annHelper.importAnns(a.annotations),this.showChange()},d.fn.cssIn=function(a){if(void 0!==a.style){var b=a.style,c=this.parent.find("button");void 0!==b.classes&&c.addClass(b.classes),void 0!==b.css&&c.css(b.css)}},d.fn.getExport=function(){return this.annHelper.exportAnns()},d.fn.getFeatures=function(){return this.annHelper.ftrs},d.fn.toggleFullscreen=function(a,b){console.log("toggleFullscreen",a),document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?a.stopFullscreen(a,b):(a.w=screen.width,a.h=screen.height-$("#annotator-top-controls").height()-$("#annotator-bottom-controls").height()-parseInt($("body").css("margin-top").replace("px",""))-parseInt($("body").css("margin-bottom").replace("px","")),a.container.width(a.w).height(a.h),a.cHelper.reset(a.w,a.h),a.showChange(),element=$(".annotator")[0],element.requestFullscreen?element.requestFullscreen():element.mozRequestFullScreen?element.mozRequestFullScreen():element.webkitRequestFullscreen?element.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):element.msRequestFullscreen&&element.msRequestFullscreen())},d.fn.stopFullscreen=function(a,b){console.log("stopFullscreen",a),a.w=a.originalW,a.h=a.originalH,a.container.width(a.w).height(a.h),a.cHelper.reset(a.w,a.h),a.showChange(),(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())},d.fn.update=function(a,b,c){var d=this;this.img=a,null!==this.img&&this.img.load(function(){d.cHelper.imgLoaded(d.img)}),this.w=b,this.h=c,this.container.width(b).height(c),this.cHelper.reset(b,c),this.annHelper.reset()},d.fn.build=function(a){function b(){!1===document.webkitIsFullScreen?c.stopFullscreen(c,!1):!1===document.mozFullScreen?c.stopFullscreen(c,!1):!1===document.msFullscreenElement&&c.stopFullscreen(c,!1)}a.addClass("annotator"),a.data("Annotator",this);var c=this;console.log("Annotator",this),this.divTop=$('<div id="annotator-top-controls"></div>').appendTo(a).css("width","100%"),this.divRight=$("<div></div>").appendTo(this.divTop).css("float","right"),this.divLeft=$("<div></div>").appendTo(this.divTop),this.divClear=$("<div></div>").appendTo(this.divTop).css("clear","both"),this.zoomin=$('<button id="zoomin">+</button>').appendTo(this.divLeft),this.zoomout=$('<button id="zoomout">-</button>').appendTo(this.divLeft),this.pan=$('<button id="pan">Pan</button>').appendTo(this.divLeft).css("margin-right","20px"),this.annotate=$('<button id="annot">Annotate</button>').appendTo(this.divLeft),this.annType=$('<select id="typesel"></select>').html("<option>Box</option><option>Line</option><option>Point</option><option>Polygon</option>").appendTo(this.divLeft),this.edit=$('<button id="edit">Edit</button>').appendTo(this.divLeft).css("margin-right","20px"),this.title=$("<label>Annotating:</label>").appendTo(this.divLeft).css("margin-right","10px"),this.ftrSel=$('<select id="ftrsel"></select>').html("<option>Image</option>").prop("disabled",!0).appendTo(this.divLeft),this.tip=$("<span>Tip: Double-click the last point to complete a line or a polygon.</span>").appendTo(this.divRight).addClass("text-muted"),this.gofull=$('<button id="toggle_fullscreen">Toggle fullscreen</button>').appendTo(this.divRight).css("margin-left","10px").click(function(){c.toggleFullscreen(c,!0)}),document.addEventListener&&(document.addEventListener("webkitfullscreenchange",b,!1),document.addEventListener("mozfullscreenchange",b,!1),document.addEventListener("fullscreenchange",b,!1),document.addEventListener("MSFullscreenChange",b,!1)),this.container=$("<div tabindex=0></div>").css(j).width(this.w).height(this.h).appendTo(a),this.canvas=$("<canvas>Unsupported browser.</canvas>").css(k).appendTo(this.container),this.divBottom=$('<div id="annotator-bottom-controls"></div>').appendTo(a),this.delAnn=$('<button id="nextAnn">Delete Annotation</button>').appendTo(this.divBottom),this.canvas[0].onselectstart=function(){return!1},this.canvas[0].oncontextmenu=function(){return!1},this.cHelper=new f(this);var d=this;this.zoomin.click(function(){d.cHelper.zoom(1.25)}),this.zoomout.click(function(){d.cHelper.zoom(.8)}),this.annType.change(function(){switch($(this).val()){case"Box":d.annHelper.changeType("rect"),d.switchOp("annotate");break;case"Polygon":d.annHelper.changeType("poly"),d.switchOp("annotate");break;case"Line":d.annHelper.changeType("line"),d.switchOp("annotate");break;case"Point":d.annHelper.changeType("point"),d.switchOp("annotate")}}),this.ftrSel.change(function(){for(var a=$(this).val(),b=d.annHelper.getFtrs(),c=0;c<b.length;c++){var e=b[c];if(a===e.fmtName())return void d.annHelper.setFtr(e)}}),this.pan.click(function(){d.switchOp("pan")}),this.annotate.click(function(){d.switchOp("annotate")}),this.edit.click(function(){d.switchOp("edit")}),this.delAnn.click(function(){d.annHelper.delAnn(),d.updateControls(),d.cHelper.repaint()}),this.canvas.mousedown(function(a){if(d.img)switch(a.which){case 1:d.curTool.lbDown(a.pageX,a.pageY);break;case 3:a.preventDefault(),d.curTool.rbDown(a.pageX,a.pageY)}}),this.canvas.mousemove(function(a){d.curTool.mMove(a.pageX,a.pageY)}),this.canvas.mouseup(function(a){if(d.img)switch(a.which){case 1:d.curTool.lbUp(a.pageX,a.pageY);break;case 3:a.preventDefault(),d.curTool.rbUp(a.pageX,a.pageY)}}),this.canvas.dblclick(function(a){return d.curTool.lbDbl(a.pageX,a.pageY),a.preventDefault(),!1}),this.container.keydown(function(a){if(d.img){var b=a.keyCode;console.log("Key "+b),d.curTool.keyDown(b)}}),this.update(this.img,this.w,this.h)},d.fn.showChange=function(){this.cHelper.repaint(),this.updateControls()},d.fn.lockSelect=function(a,b){this.img?(this.annType.prop("disabled",b),b&&("rect"===a?this.annType.val("Box"):"poly"===a?this.annType.val("Polygon"):"line"===a?this.annType.val("Line"):this.annType.val("Point"))):this.annType.prop("disabled",!0)},d.fn.dispFtr=function(a){this.ftrSel.val(a.fmtName())},d.fn.updateFtrs=function(a){var b="";this.ftrSel.prop("disabled",!1);for(var c=0;c<a.length;c++){var d=a[c];b=b.concat("<option>"+d.fmtName()+"</option>")}this.ftrSel.empty().html(b)},d.fn.updateControls=function(){var a=this.annHelper;this.delAnn.prop("disabled",!a.getAnn().valid||!this.img),this.zoomin.prop("disabled",!this.img),this.zoomout.prop("disabled",!this.img),this.pan.prop("disabled",!this.img),this.annotate.prop("disabled",!this.img),this.edit.prop("disabled",!this.img)},d.fn.switchOp=function(a){switch(a){case"annotate":this.curTool=new h(this),this.canvas.css("cursor","crosshair");break;case"pan":this.curTool=new g(this),this.canvas.css("cursor","move");break;case"edit":this.curTool=new i(this),this.canvas.css("cursor","select")}},b.exports=d},{"./annHelper":1,"./canvasHelper":4,"./tools/annotate":13,"./tools/edit":14,"./tools/pan":15}],3:[function(a,b,c){var d=a("./annotator");b.exports.annotator=function(a){var b,c;if(void 0!==a.src?a.img=$('<img src="'+a.src+'"></img>').hide():void 0===a.img&&(a.img=null),void 0===a.features)a.features=null;else if(!a.features instanceof Array)throw"Error: input.features is not a valid Array instance";b=void 0===a.width?640:a.width,c=void 0===a.width?480:a.height;var e,f=$(this);return f.hasClass("annotator")?(e=f.data("Annotator"),e.update(a.img,b,c)):(e=new d(a.img,b,c),e.parent=f,e.build(f)),e.featuresIn(a),e.annsIn(a),e.cssIn(a),e.showChange(),e}},{"./annotator":2}],4:[function(a,b,c){function d(a){this.parent=a;var b=a.w,c=a.h;this.canvas=a.canvas,this.g=this.canvas[0].getContext("2d"),this.canvas[0].width=b,this.canvas[0].height=c,this.w=b,this.h=c,this.imgW=b,this.imgH=c,this.defScale=1,this.curScale=this.defScale,this.xOffs=0,this.yOffs=0,this.hlt=null,this.select=[]}d.fn=d.prototype,d.fn.repaint=function(){var a=this.g,b=this.parent.getFeatures();a.setTransform(1,0,0,1,0,0),a.fillStyle="rgb(240, 240, 240)",a.fillRect(0,0,this.w,this.h),a.translate(this.w/2+this.xOffs,this.h/2+this.yOffs),a.scale(this.curScale,this.curScale),a.shadowColor="#555",a.shadowBlur=20,null!==this.parent.img?a.drawImage(this.parent.img[0],-this.imgW/2,-this.imgH/2):(a.fillStyle="rgb(220, 220, 220)",a.fillRect(-this.imgW/2,-this.imgH/2,this.imgW,this.imgH),a.shadowBlur=0,a.fillStyle="white",a.font="22px sans-serif",a.fillText("No Image",-40,-8));for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.anns.length;e++)this.drawAnn(d.anns[e],c);this.parent.curTool&&this.parent.curTool.draw(a)},d.fn.drawAnn=function(a,b){var c=this.g,d=[["rgb(255, 20, 20)","rgb(255, 80, 80)"],["rgb(0, 200, 0)","rgb(80, 240, 80)"],["rgb(0, 0, 255)","rgb(80, 80, 255)"],["rgb(255, 255, 0)","rgb(255, 255, 90)"],["rgb(50, 200, 200)","rgb(90, 255, 255)"]];if(a.valid){var e=d[b%d.length],f=e[0],g=0,h=!1;a!==this.hlt&&this.parent.annHelper.getAnn()!==a||(g=1,f=e[1],h=!0),"point"!==a.type&&"point"!==this.parent.annHelper.getAnn()||(g=1,f=e[1],h=!0),c.shadowColor="#FFF",c.shadowBlur=0,c.fillStyle=f;var i=a.getDrawPts();c.beginPath(),c.moveTo(i[0].x,i[0].y);for(var j=1;j<i.length;j++)c.lineTo(i[j].x,i[j].y);if(c.strokeStyle=e[g],c.lineWidth=1.5/this.curScale,c.stroke(),h)for(j=0;j<i.length;j++)this.drawPt(i[j])}},d.fn.drawPt=function(a){var b=this.g;b.beginPath(),b.arc(a.x,a.y,3/this.curScale,0,2*Math.PI,!1),b.fill()},d.fn.doPan=function(a,b){this.xOffs+=a,this.yOffs+=b;var c=this.imgW/2*this.curScale,d=this.imgH/2*this.curScale;this.xOffs>c&&(this.xOffs=c),this.xOffs<-c&&(this.xOffs=-c),this.yOffs>d&&(this.yOffs=d),this.yOffs<-d&&(this.yOffs=-d),this.repaint()},d.fn.zoom=function(a){this.curScale*=a,this.curScale<this.defScale&&(this.curScale=this.defScale),this.doPan(0,0),this.repaint()},d.fn.reset=function(a,b){if(this.canvas[0].width=a,this.canvas[0].height=b,this.w=a,this.h=b,this.parent.img){var c=this.parent.img;this.imgW=c[0].width,this.imgH=c[0].height}else this.imgW=a,this.imgH=b;this.xOffs=0,this.yOffs=0,this.calcZoom(),this.curScale=this.defScale},d.fn.imgLoaded=function(a){this.imgW=a[0].width,this.imgH=a[0].height,this.calcZoom(),this.curScale=this.defScale,this.repaint()},d.fn.calcZoom=function(){var a=this.w/this.imgW,b=this.h/this.imgH,c=Math.min(a,b);this.defScale=.9*c},d.fn.setHlt=function(a){this.hlt=a},d.fn.ptToImg=function(a,b){var c=this.canvas.offset();a-=c.left,b-=c.top;var d=this,e=(a-d.w/2-d.xOffs)/d.curScale,f=(b-d.h/2-d.yOffs)/d.curScale;return e<-d.imgW/2&&(e=-d.imgW/2),e>d.imgW/2&&(e=d.imgW/2),f<-d.imgH/2&&(f=-d.imgH/2),f>d.imgH/2&&(f=d.imgH/2),{x:e,y:f}},d.fn.scaleDist=function(a){return a/this.curScale},b.exports=d},{}],5:[function(a,b,c){function d(a,b,c){this.name=a,this.req=b,this.shape=c,this.anns=[],this.annC=0}d.fn=d.prototype,d.fn.fmtName=function(){return this.name.charAt(0).toUpperCase().concat(this.name.substr(1))},b.exports=d},{}],6:[function(a,b,c){var d=a("./api");!function(a){a.fn.annotator=d.annotator}(jQuery)},{"./api":3}],7:[function(a,b,c){function d(){e.call(this),this.type="line"}var e=a("../superShape");d.prototype=Object.create(e.prototype),d.fn=d.prototype,d.fn.addPt=function(a){return 0===this.pts.length?this.pts=[a,a]:this.pts.push(a),this.valid=!0,!0},d.fn.insPt=function(a,b){a<0||a>this.pts.length||this.pts.splice(a,0,b)},d.fn.canInsPt=function(){return!0},d.fn.modLastPt=function(a){this.pts.length>0&&(this.pts[this.pts.length-1]=a)},d.fn.modPt=function(a,b){a>=0&&a<this.pts.length&&(this.pts[a]=b)},d.fn.getDrawPts=function(){return this.pts},d.fn.delPt=function(a){this.pts.splice(a,1),this.pts.length<2&&(this.invalidate(),this.pts=[])},d.fn.getExport=function(){var a={};return a.type="line",a.points=this.pts,a},b.exports=d},{"../superShape":11}],8:[function(a,b,c){function d(){e.call(this),this.type="point"}var e=a("../superShape");d.prototype=Object.create(e.prototype),d.fn=d.prototype,d.fn.addPt=function(a){if(0===this.pts.length)return this.pts.push(a),this.valid=!0,!1},d.fn.modLastPt=function(a){1===this.pts.length&&(this.pts[0]=a)},d.fn.modPt=function(a,b){1===this.pts.length&&(this.pts[0]=b)},d.fn.getDrawPts=function(){if(!this.valid)return[];var a=[],b=this.pts[0].x,c=this.pts[0].y;return a.push({x:b,y:c}),a.push({x:b,y:c}),a},d.fn.getPts=function(){if(this.valid){return[this.getDrawPts()[0]]}return[]},d.fn.delPt=function(a){this.invalidate()},d.fn.getExport=function(){var a={};a.type="point";var b=this.pts[0].x,c=this.pts[0].y;return a.pos={x:b,y:c},a},b.exports=d},{"../superShape":11}],9:[function(a,b,c){function d(){e.call(this),this.type="poly"}var e=a("../superShape");d.prototype=Object.create(e.prototype),d.fn=d.prototype,d.fn.addPt=function(a){return 0===this.pts.length?this.pts=[a,a]:this.pts.push(a),this.valid=!0,!0},d.fn.insPt=function(a,b){a<0||a>this.pts.length||this.pts.splice(a,0,b)},d.fn.canInsPt=function(){return!0},d.fn.modLastPt=function(a){this.pts.length>0&&(this.pts[this.pts.length-1]=a)},d.fn.modPt=function(a,b){a>=0&&a<this.pts.length&&(this.pts[a]=b)},d.fn.getDrawPts=function(){return this.pts.concat([this.pts[0]])},d.fn.delPt=function(a){this.pts.splice(a,1),this.pts.length<2&&(this.invalidate(),this.pts=[])},d.fn.getExport=function(){var a={};return a.type="poly",a.points=this.pts,a},b.exports=d},{"../superShape":11}],10:[function(a,b,c){function d(){e.call(this),this.type="rect"}var e=a("../superShape");d.prototype=Object.create(e.prototype),d.fn=d.prototype,d.fn.addPt=function(a){return 0===this.pts.length?(this.pts.push(a),this.pts.push(a),this.valid=!0,!0):(this.pts[1]=a,!1)},d.fn.modLastPt=function(a){2===this.pts.length&&(this.pts[1]=a)},d.fn.modPt=function(a,b){switch(a){case 0:this.pts[0]=b;break;case 1:this.pts[1].x=b.x,this.pts[0].y=b.y;break;case 2:this.pts[1]=b;break;case 3:this.pts[0].x=b.x,this.pts[1].y=b.y}},d.fn.getDrawPts=function(){if(!this.valid)return[];var a=[],b=this.pts[0].x,c=this.pts[0].y,d=this.pts[1].x,e=this.pts[1].y;return a.push({x:b,y:c}),a.push({x:d,y:c}),a.push({x:d,y:e}),a.push({x:b,y:e}),a.push({x:b,y:c}),a},d.fn.getPts=function(){if(this.valid){return this.getDrawPts().slice(0,-1)}return[]},d.fn.delPt=function(a){this.invalidate()},d.fn.getExport=function(){var a={};a.type="rect";var b=this.pts[0].x,c=this.pts[0].y,d=this.pts[1].x,e=this.pts[1].y,f=Math.abs(d-b),g=Math.abs(e-c),h=Math.min(b,d),i=Math.min(c,e);return a.pos={x:h,y:i},a.size={width:f,height:g},a},b.exports=d},{"../superShape":11}],11:[function(a,b,c){function d(){this.valid=!1,this.pts=[],this.type="none"}d.fn=d.prototype,d.fn.invalidate=function(){this.valid=!1},d.fn.isValid=function(){return this.valid},d.fn.addPt=function(a){return!1},d.fn.modLastPt=function(a){},d.fn.modPt=function(a,b){},d.fn.insPt=function(a,b){},d.fn.delPt=function(a){},d.fn.getDrawPts=function(){return[]},d.fn.getExport=function(){return{}},d.fn.getNumPts=function(){return this.pts.length},d.fn.getPts=function(){return this.pts},d.fn.canInsPt=function(){return!1},d.fn.getBounds=function(){if(0===this.pts.length)return null;var a={};a.x0=this.pts[0].x,a.y0=this.pts[0].y,a.x1=a.x0,a.y1=a.y0;for(var b=1;b<this.pts.length;b++){var c=this.pts[b];a.x0=Math.min(a.x0,c.x),a.x1=Math.max(a.x1,c.x),a.y0=Math.min(a.y0,c.y),a.y1=Math.max(a.y1,c.y)}return a},b.exports=d},{}],12:[function(a,b,c){function d(){this.x0=0,this.x1=0,this.y0=0,this.y1=0,this.active=!1}d.fn=d.prototype,d.fn.lbDown=function(a,b){},d.fn.lbUp=function(a,b){},d.fn.lbDbl=function(a,b){},d.fn.rbDown=function(a,b){},d.fn.rbUp=function(a,b){},d.fn.mMove=function(a,b){},d.fn.keyDown=function(a){},d.fn.draw=function(a){},b.exports=d},{}],13:[function(a,b,c){function d(a){e.call(this),this.parent=a,this.ann=null}var e=a("../superTool");d.prototype=Object.create(e.prototype),d.fn=d.prototype,d.fn.lbUp=function(a,b){var c=this.parent;this.active||(this.active=!0,this.ann=c.annHelper.newAnn());var d=c.cHelper.ptToImg(a,b);this.active=this.ann.addPt(d),c.showChange()},d.fn.lbDbl=function(a,b){if(this.active){var c=this.parent;this.active=!1,this.ann.delPt(-1),this.ann.delPt(-1),c.showChange()}},d.fn.mMove=function(a,b){if(this.active){var c=this.parent.cHelper,d=c.ptToImg(a,b);this.ann.modLastPt(d),c.repaint()}},d.fn.keyDown=function(a){var b=this.parent.annHelper;switch(a){case 46:b.getAnn().invalidate(),this.active=!1,this.parent.showChange();break;case 8:if(this.active){var c=this.ann.getPts()[this.ann.getNumPts()-1];this.ann.delPt(-1),this.active=this.ann.isValid(),this.active&&this.ann.modLastPt(c),this.parent.showChange()}}},b.exports=d},{"../superTool":12}],14:[function(a,b,c){function d(a){e.call(this),this.parent=a,this.canEdit=!1,this.editing=!1,this.editPt=0,this.hlt=null}var e=a("../superTool");d.prototype=Object.create(e.prototype),d.fn=d.prototype,d.fn.mMove=function(a,b){var c=this.parent,d=c.cHelper,e=d.ptToImg(a,b);if(this.editing){c.annHelper.getAnn().modPt(this.editPt,e),this.hlt=e,c.showChange()}else this.passiveMove(e.x,e.y),c.showChange()},d.fn.lbDown=function(a,b){var c=this.parent.annHelper,d=this.parent.cHelper,e=d.ptToImg(a,b),f=c.getAnn();if(this.canEdit)if(this.editing){if(this.editing)return void(this.editing=!1)}else{var g=c.pickPt(e.x,e.y);if(g.ann===f&&g.dist<d.scaleDist(15))return this.editPt=g.ind,void(this.editing=!0);if(f.canInsPt()){var h=c.pickLn(e.x,e.y);if(h.ann===f&&h.dist<d.scaleDist(15))return f.insPt(h.i1,e),this.editPt=h.i1,void(this.editing=!0)}}else{var i=c.pickLn(e.x,e.y);if(i.dist<d.scaleDist(15))return void c.setAnn(i.ann)}},d.fn.passiveMove=function(a,b){var c=this.parent.cHelper,d=this.parent.annHelper,e=d.pickPt(a,b),f=d.pickLn(a,b),g=null;if(e.dist<c.scaleDist(15))g=e;else{if(!(f.dist<c.scaleDist(15)))return this.canEdit=!1,this.hlt=null,void c.setHlt(null);g=f}g.ann===d.getAnn()?(this.canEdit=!0,g!==f||g.ann.canInsPt()?this.hlt=g.pt:this.hlt=null):(this.canEdit=!1,this.hlt=null),"point"===g.ann.type&&(d.aInd=d.anns.indexOf(g.ann),d.curType="point",this.canEdit=!0,g!==f||g.ann.canInsPt()?this.hlt=g.pt:this.hlt=null),c.setHlt(g.ann)},d.fn.rbDown=function(a,b){var c=this.parent.annHelper,d=this.parent.cHelper,e=d.ptToImg(a,b),f=c.getAnn();if(this.canEdit&&!this.editing){var g=c.pickPt(e.x,e.y);if(g.ann===f&&g.dist<d.scaleDist(15))return void f.delPt(g.ind)}},d.fn.keyDown=function(a){var b=this.parent.annHelper;switch(a){case 46:this.editing?(b.getAnn().delPt(this.editPt),this.editing=!1):b.delAnn(),this.parent.showChange()}},d.fn.draw=function(a){this.hlt&&(a.fillStyle="white",this.parent.cHelper.drawPt(this.hlt))},b.exports=d},{"../superTool":12}],15:[function(a,b,c){function d(a){e.call(this),this.parent=a}var e=a("../superTool");d.prototype=Object.create(e.prototype),d.fn=d.prototype,d.fn.lbDown=function(a,b){this.active||(this.x0=a,this.y0=b,this.active=!0)},d.fn.lbUp=function(a,b){this.active=!1},d.fn.mMove=function(a,b){if(this.active){var c=a-this.x0,d=b-this.y0;this.parent.cHelper.doPan(c,d),this.x0=a,this.y0=b}},b.exports=d},{"../superTool":12}],16:[function(a,b,c){var d=a("./shapes/rect"),e=a("./shapes/poly"),f=a("./shapes/point"),g=a("./shapes/line");b.exports.createAnnotation=function(a){switch(a){case"rect":return new d;case"poly":return new e;case"point":return new f;case"line":return new g}}},{"./shapes/line":7,"./shapes/point":8,"./shapes/poly":9,"./shapes/rect":10}]},{},[6]);